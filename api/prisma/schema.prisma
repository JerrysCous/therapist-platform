generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(CLIENT)
  createdAt DateTime @default(now())

  therapistProfile TherapistProfile?
  clientProfile    ClientProfile?

  // Messages
  sentMessages     Message[] @relation("MessagesSent")
  receivedMessages Message[] @relation("MessagesReceived")

  // Appointments
  therapistAppointments Appointment[] @relation("TherapistAppointments")
  clientAppointments    Appointment[] @relation("ClientAppointments")

  // Mapping between therapist + client
  therapistLinks TherapistLink[] @relation("TherapistClients")
  clientLinks    TherapistLink[] @relation("ClientTherapist")

  // üëá NEW REQUIRED OPPOSITE RELATION FOR AVAILABILITY
  availabilitySlots AvailabilitySlot[]
}

model TherapistProfile {
  id             Int     @id @default(autoincrement())
  userId         Int     @unique
  bio            String?
  specialization String?
  availability   String?

  user User @relation(fields: [userId], references: [id])
}

model ClientProfile {
  id               Int     @id @default(autoincrement())
  userId           Int     @unique
  notes            String?
  preferences      String?
  emergencyContact String?

  user User @relation(fields: [userId], references: [id])
}

model Message {
  id         Int      @id @default(autoincrement())
  senderId   Int
  receiverId Int
  text       String
  createdAt  DateTime @default(now())

  sender   User @relation("MessagesSent", fields: [senderId], references: [id])
  receiver User @relation("MessagesReceived", fields: [receiverId], references: [id])
}

model Appointment {
  id          Int               @id @default(autoincrement())
  therapistId Int
  clientId    Int
  time        DateTime
  status      AppointmentStatus @default(PENDING)
  reason      String?   // ‚Üê added for appointment purpose

  therapist User @relation("TherapistAppointments", fields: [therapistId], references: [id])
  client    User @relation("ClientAppointments", fields: [clientId], references: [id])
}

model TherapistLink {
  id          Int @id @default(autoincrement())
  therapistId Int
  clientId    Int

  therapist User @relation("TherapistClients", fields: [therapistId], references: [id])
  client    User @relation("ClientTherapist", fields: [clientId], references: [id])

  @@unique([therapistId, clientId])
}

model AvailabilitySlot {
  id          Int @id @default(autoincrement())
  therapistId Int

  weekday     Int    // 0 = Sunday ... 6 = Saturday
  startTime   String // "09:00" 24h format
  endTime     String // "12:00"

  therapist User @relation(fields: [therapistId], references: [id])
}

enum Role {
  OWNER
  PRACTICE_MANAGER_ADMIN
  PRACTICE_MANAGER_CLINICAL
  THERAPIST
  INTERN
  CLIENT
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  RESCHEDULE_REQUESTED
  RESCHEDULED
  RESCHEDULE_DENIED
}


